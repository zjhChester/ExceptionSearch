<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="xyz.zjhwork.dao.ExceptionDao">
    <select id="findException" parameterType="xyz.zjhwork.entity.Exception" resultType="xyz.zjhwork.entity.Exception">
        select * from exception
        <where>
            <if test="id != null ">
                and id = #{id}
            </if>
            <if test="title != null and title!=''">
                and title like concat('',#{title},'%')
            </if>
            <if test="desc != null and desc!=''">
                and  exception.desc like concat('',#{desc},'%')
            </if>
            <if test="content != null and content!=''">
                and content like concat('%',#{content},'%')
            </if>
            <if test="author != null and author!=''">
                and author = #{author}
            </if>
            <if test="type != null and type!=''">
                and  exception.type = #{type}
            </if>
        </where>
    </select>

    <update  parameterType="xyz.zjhwork.entity.Exception" id="updateException">
        update exception
        <trim prefix="set" suffixOverrides=",">
            <if test="title!=null and title!=''">
                title = #{title},
            </if>
            <if test="desc!=null and desc!=''">
                exception.desc = #{desc},
            </if>
            <if test="content!=null and content!=''">
                content = #{content},
            </if>
            <if test="author!=null and author!=''">
                author = #{author},
            </if>
            <if test="remark!=null and remark!=''">
                remark = #{remark},
            </if>
            <if test="type!=null and type!=''">
                exception.type = #{type},
            </if>
            <if test="views!=null and views!=''">
                views = #{views},
            </if>
        </trim>
        where id = #{id}

    </update>

    <select id="searchExceptionByKeywords" resultType="xyz.zjhwork.entity.Exception">
        select id from exception
        <where>
            <if test="title != null  ">
                and
                <foreach item="item" collection="title" index="index" separator="OR">
                 title like concat('',#{item},'%')
                </foreach>
                order by length(title) desc
            </if>
            <if test="desc != null ">
                and
                <foreach item="item" collection="desc" index="index" separator="OR">
                    exception.desc like concat('',#{item},'%')
                </foreach>
                order by length(exception.desc) desc
            </if>
            <if test="content != null ">
                and
                <foreach item="item" collection="content" index="index" separator="OR">
                    locate (#{item},content)
                </foreach>
                order by length(content) desc
            </if>
            <if test="type != null ">
                and
                <foreach item="item" collection="type" index="index" separator="OR">
                    exception.type like concat('',#{item},'%')
                </foreach>
                order by length(exception.type) desc
            </if>
        </where>
        limit #{currIndex} , 20
    </select>

    <select id="searchCount" parameterType="xyz.zjhwork.entity.Exception" resultType="Integer">
        select count(id) from exception
        <where>
            <if test="title != null  ">
                and
                <foreach item="item" collection="title" index="index" separator="OR">
                    title like concat('',#{item},'%')
                </foreach>
            </if>
            <if test="desc != null ">
                and
                <foreach item="item" collection="desc" index="index" separator="OR">
                    exception.desc like concat('',#{item},'%')
                </foreach>
            </if>
            <if test="content != null ">
                and
                <foreach item="item" collection="content" index="index" separator="OR">
                    locate (#{item},content)
                </foreach>
            </if>
            <if test="type != null ">
                and
                <foreach item="item" collection="type" index="index" separator="OR">
                    exception.type like concat('',#{item},'%')
                </foreach>
            </if>
        </where>
    </select>
    <select id="searchAssociation" resultType="Integer">
        select id from exception
        <where>
            <if test="keywords != null  ">
                and
                <foreach item="item" collection="keywords" index="index" separator="OR">
                    title like concat('',#{item},'%')
                </foreach>
            </if>
        </where>
        order by length(title) desc
        limit 1 , 7
    </select>
</mapper>